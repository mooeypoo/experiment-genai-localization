# Step 05 — User Preferred Name

## 1) Summary

This step adds a `preferredName` field to the user model — an optional short name that controls how the user is referred to in conversational UI contexts. A new `getDisplayName(userId)` function in the data layer resolves the preferred name with a fallback to the full display name. The "Viewing as" header dropdown and the "Posting as" comment-form label both use this resolver. The create-user form now includes a "Preferred name" input. Two of the four seeded users have preferred names set to demonstrate the contrast between resolved and fallback behavior.

## 2) Decisions & Rationale

### A freeform `preferredName` string rather than a format enum
The prompt says "a preference for how they should be referred to in the UI." Two interpretations were plausible: (a) a freeform name the user supplies, or (b) an enum choosing between display formats (e.g., "full name", "first name", "username"). A freeform field was chosen because it is more expressive — it covers nicknames, initials, shortened names, and culturally specific preferences that an enum could never anticipate. It is also simpler to implement: one string field, one fallback rule.

### `getDisplayName(userId)` as a store-level resolver
Rather than having every component check `user.preferredName || user.name`, the resolution logic lives in one function in the data layer. This keeps the fallback rule centralized — if the rule evolves (e.g., falling back to username instead of full name), only one function changes. Components call `getDisplayName(user.id)` and don't need to know the resolution logic.

### Two seeded users with preferred names, two without
Alice has `"preferredName": "Alice"` (first name) and Carol has `"preferredName": "CD"` (initials). Bob and Dan have empty strings. This mix demonstrates both the resolved and fallback paths in the header dropdown side by side, making the feature visually obvious without reading code.

### The "Viewing as" dropdown and "Posting as" label use `getDisplayName`
These are the two most personal, conversational touchpoints in the UI — they address the user directly. Using the preferred name here feels natural ("Posting as **Evie**" rather than "Posting as **Eve Nakamura**"). Formal contexts like the user card grid, profile heading, and comment author names continue to use the full display name, since those serve an identifying purpose where the full name is more useful.

### User cards and comment list still show full names
The preferred name is intended for how the app talks *to* the user, not how the user is identified *to others*. A short nickname like "CD" is clear when it refers to yourself but ambiguous when displayed next to a comment. Keeping the full name in identifying contexts avoids confusion.

### `preferredName` is optional with empty-string default
The field defaults to `''` in both the seed data and `createUser`. The `getDisplayName` resolver uses `||`, so any falsy value (empty string, undefined, null) falls through to the full name. This means legacy user objects (created before this field existed) work without migration.

## 3) Ambiguities Encountered

### "A preference for how they should be referred to" — name or format?
**Options considered:**
1. A freeform `preferredName` string (user writes whatever they want to be called).
2. An enum (`"full"`, `"first"`, `"username"`) and the app derives the display string.
3. A `pronouns` field (unrelated to name display but loosely fits "referred to").

**Resolution:** Option 1. A freeform string is the most flexible and requires no parsing or heuristic logic (like extracting a first name from a full name, which is culturally fraught). The enum approach would force assumptions about name structure. Pronouns are a different concept and were not requested.

### Which UI messages should use the preferred name?
**Options considered:**
1. All user name displays everywhere (cards, comments, profile, header, form).
2. Only the most personal/conversational contexts (header dropdown, posting-as label).
3. Exactly one message (the prompt says "at least one").

**Resolution:** Option 2. The prompt says "at least one" but the two most natural places are the header and the comment form — both speak directly to the current user. Applying it to all name displays would blur the distinction between "how the app refers to you" and "how you're identified to others."

### Should "Preferred name" be validated?
**Options considered:**
1. No validation (any string, including very long or weird ones).
2. Length limit only.
3. Required if present (non-empty after trim, or blank).

**Resolution:** Option 1 with trim. The field is optional; if provided, it's trimmed and stored. No length or character restrictions — the same policy as the bio field. Over-constraining a freeform preference field would undermine its purpose.

### Should the user profile page show the preferred name?
**Options considered:**
1. Show it as a subtitle (e.g., "Also known as Alice").
2. Don't show it on the profile — it's an internal preference, not a public display.

**Resolution:** Option 2 for now. The profile page shows the full name and username as identifiers. The preferred name is used in how the *app* addresses the user, not as profile metadata. It could be shown later if there's a settings or edit-profile view.

## 4) Tradeoffs

| Decision | Upside | Downside |
|---|---|---|
| Freeform string (not enum) | Maximum flexibility; no name-parsing logic | Users can enter anything, including confusing or empty-seeming values |
| Centralized `getDisplayName` resolver | Single source of truth for display logic | Every call site must remember to use it instead of `user.name` |
| Preferred name only in conversational contexts | Clear semantic distinction between "addressed" and "identified" | Users might expect their preferred name to appear everywhere |
| Empty string as "not set" | No separate boolean flag needed; `||` fallback is trivial | Can't distinguish "user explicitly chose empty" from "user never set it" |

## 5) Non-Goals

- **Profile editing.** There is still no way to edit a user's preferred name (or any field) after creation. An edit-profile form is a natural follow-up.
- **Applying preferred name to all name displays.** Comment author names, user cards, and profile headings intentionally still use the full name.
- **Pronouns.** A pronoun field is a separate concern and was not requested.
- **Name format selection UI.** A radio group choosing between "full name" / "first name" / "username" was considered but rejected in favor of the simpler freeform approach.

## 6) Files Changed

| File | Change | Purpose |
|---|---|---|
| `src/data/seed.json` | **Modified** | Added `preferredName` to all 4 users (Alice: "Alice", Carol: "CD", Bob & Dan: empty) |
| `src/data/store.js` | **Modified** | Added `getDisplayName(userId)` resolver; `createUser` now accepts optional `preferredName` |
| `src/components/CreateUserForm.vue` | **Modified** | Added "Preferred name" input field between display name and bio |
| `src/components/CommentForm.vue` | **Modified** | "Posting as" label now uses `getDisplayName(currentUser.id)` |
| `src/components/AppHeader.vue` | **Modified** | "Viewing as" dropdown options now use `getDisplayName(user.id)` |
| `docs/agent-notes/05.md` | **New** | This file |

## 7) Manual Verification Checklist

- [ ] `npm run build` succeeds.
- [ ] The "Viewing as" dropdown shows "Alice", "Bob Chen", "CD", "Dan Okafor" (preferred names where set, full names as fallback).
- [ ] Selecting Alice shows "Posting as **Alice**" on the post page.
- [ ] Selecting Bob shows "Posting as **Bob Chen**" (fallback to full name).
- [ ] Selecting Carol shows "Posting as **CD**".
- [ ] The create-user form has a "Preferred name" field between display name and bio.
- [ ] Creating a user with a preferred name: the preferred name appears in the "Viewing as" dropdown and the "Posting as" label.
- [ ] Creating a user without a preferred name: the full display name is used in both places.
- [ ] User cards in the grid still show full display names (not preferred names).
- [ ] Comment author names in the comment list still show full display names.
- [ ] The user profile page still shows the full display name as the heading.

## 8) Known Issues / Follow-ups

- **No way to edit the preferred name after creation.** Once a user is created, their preferred name is fixed until page refresh. An edit-profile form would address this.
- **`getDisplayName` must be called explicitly.** Components that forget to use it will show the full name. A future refactor could make it a computed property on the user object itself, but that would couple the user model to the resolution logic.
- **The user profile page does not display the preferred name.** It could show a "(goes by X)" subtitle, but this was deferred to keep the profile focused on identity.
- **Very short preferred names (like "CD") may be ambiguous in the dropdown.** If two users both prefer "CD", the dropdown offers no way to distinguish them. Showing the full name in parentheses (e.g., "CD (Carol Diaz)") could help but was not added to keep the UI clean for the common case.
