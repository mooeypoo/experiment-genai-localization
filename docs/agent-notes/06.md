# Step 06 — Bio Character Limit

## 1) Summary

This step adds a 160-character limit to the bio field. The limit is enforced as a named constant (`BIO_MAX_LENGTH`) exported from the data layer and validated inside `createUser`. The create-user form displays a live character counter below the bio textarea that updates on every keystroke, turns red when the limit is exceeded, and the textarea itself gains a red border. On submit, the store rejects a bio that exceeds the limit with a clear error message.

## 2) Decisions & Rationale

### Limit constant exported from the store, not hardcoded in the component
`BIO_MAX_LENGTH = 160` is defined and exported from `store.js`. The form imports it to drive the counter display, and the store uses it for validation. This keeps the limit in one place — if it changes, only the constant needs updating. The form has no local knowledge of what the limit is; it asks the store.

### No `maxlength` attribute on the textarea
The HTML `maxlength` attribute would silently prevent typing beyond 160 characters, which satisfies "prevent exceeding" but provides poor feedback — the user would hit an invisible wall with no explanation. Instead, the textarea allows free input. The live counter and red styling provide "clear feedback when limit is exceeded," and the store validation prevents the mutation from succeeding. This lets users paste a long bio, see *exactly* how far over they are, and edit it down deliberately.

### Validation in the store (not just the component)
Consistent with steps 03 and 04, all validation lives in the data layer. The form is a thin display layer. If another consumer of `createUser` were added (e.g., a batch import), it would get the same length check without duplicating logic. The component provides UX feedback (counter, color) but does not independently block submission — that is the store's job.

### Counter shows current / max at all times (not just when approaching the limit)
Some implementations only show the counter when the user is near the limit (e.g., within 20 characters). A persistent counter was chosen because: (a) it's simpler to implement, (b) it sets expectations upfront — the user knows there's a limit before they start typing, and (c) it avoids the jarring appearance of a counter mid-typing.

### Red border on the textarea and bold red counter text
Two visual signals reinforce the over-limit state: the textarea's border changes to red, and the counter text becomes red and bold. This provides redundant feedback — useful for users who might not notice one or the other. The red color (#c44) was chosen to be clearly distinct from the default gray (#999) without being as aggressive as a pure red (#f00).

### 160 characters as the limit
The prompt specifies 160. This is a familiar number (SMS length) and matches the "short bio" intent established in step 04.

## 3) Ambiguities Encountered

### Should the textarea prevent typing beyond the limit or allow it and show feedback?
**Options considered:**
1. Use `maxlength="160"` to hard-cap input at the browser level.
2. Allow free typing, show a live counter, and block submission in the store.
3. Allow free typing up to 160, then silently truncate on submit.

**Resolution:** Option 2. The prompt says both "prevent exceeding limit" and "clear feedback when limit is exceeded." Option 1 prevents exceeding but can't show feedback *when exceeded* because the state never occurs. Option 3 would silently lose data. Option 2 satisfies both requirements: the counter provides feedback, and the store prevents the mutation.

### Should the counter count the raw input or the trimmed value?
**Options considered:**
1. Count `bio.value.length` (raw input, including leading/trailing whitespace).
2. Count `bio.value.trim().length` (what the store actually validates).

**Resolution:** Option 1 for the live counter, option 2 for the store validation. The counter reflects what the user sees in the textarea (raw characters). The store validates the trimmed version. This means a user could type 162 characters with 3 trailing spaces, see "162 / 160" (over), but the store would accept it because the trimmed value is 159. This edge case is acceptable — it's a minor discrepancy that favors the user, and trimming in the counter would cause confusing behavior (spaces not counting, counter jumping as you type spaces).

### Should the error message from the store mention the exact count?
**Options considered:**
1. "Bio must be 160 characters or fewer." (states the rule).
2. "Bio is 214 characters; maximum is 160." (states the count and the rule).

**Resolution:** Option 1. The live counter already shows the exact count in real time. Repeating it in the error message is redundant and risks feeling stale if the user edits the bio after the error appears (the error message would still say the old count).

## 4) Tradeoffs

| Decision | Upside | Downside |
|---|---|---|
| No `maxlength` on textarea | User can paste and see exactly how far over they are | Technically allows the over-limit state to exist in the UI |
| Persistent counter (always visible) | Sets expectations before typing | Adds visual noise to an otherwise simple form |
| Counter uses raw length, store validates trimmed | Counter matches what the user sees; store is lenient | Tiny edge case where counter says "over" but store accepts |
| Single constant shared between store and form | DRY; one source of truth | Couples the form to the store's export (acceptable) |

## 5) Non-Goals

- **Character limit on other fields.** Display name and preferred name have no length constraints. Adding them could be a follow-up.
- **Character limit on comments.** The comment body has no limit. This step focuses only on bio.
- **Auto-truncation.** The store does not truncate long bios; it rejects them entirely. The user must edit the text themselves.
- **Debounced or async validation.** The counter updates synchronously on every keystroke via Vue's reactivity. No debounce is needed for a simple `.length` check.

## 6) Files Changed

| File | Change | Purpose |
|---|---|---|
| `src/data/store.js` | **Modified** | Added `BIO_MAX_LENGTH = 160` export; added bio length validation to `createUser` |
| `src/components/CreateUserForm.vue` | **Modified** | Added live character counter (`bioLength` / `bioOver` computeds); added `.over` class to textarea and counter; imported `BIO_MAX_LENGTH` from store |
| `docs/agent-notes/06.md` | **New** | This file |

## 7) Manual Verification Checklist

- [ ] `npm run build` succeeds.
- [ ] The bio field shows "0 / 160" when empty.
- [ ] Typing updates the counter in real time (e.g., "9 / 160" after 9 characters).
- [ ] At 160 characters, the counter shows "160 / 160" in normal (gray) style.
- [ ] At 161+ characters, the counter turns red and bold, and the textarea border turns red.
- [ ] Submitting with a bio over 160 characters shows "Bio must be 160 characters or fewer." error.
- [ ] The user is not created (no new card appears in the grid).
- [ ] Reducing the bio to 160 or fewer characters returns the counter to normal style.
- [ ] Submitting with a valid bio (≤ 160 characters) creates the user successfully.
- [ ] The error list and form clear after a successful submission.
- [ ] Submitting with an empty bio (0 / 160) still works — bio is optional.

## 8) Known Issues / Follow-ups

- **Counter counts raw characters; store validates trimmed.** In the edge case where trailing/leading whitespace pushes the raw count over 160 but the trimmed value is under, the counter shows red but the store accepts. This is harmless but slightly inconsistent.
- **No character limit on comments.** The comment form could benefit from the same treatment, but it was not requested in this step.
- **No character limit on display name or preferred name.** These fields remain unconstrained.
- **The existing seeded bios are all under 160 characters** (longest is ~95). If a future seed user had a bio over 160, the store would not reject it (validation only runs via `createUser`, not on seed load). A startup validation pass could be added if needed.
