# Step 11 — Locale-Aware Dates & Numbers

## Summary

This step improves how timestamps and numeric values are displayed, making them fully aware of the currently selected language. Comment timestamps and the post timestamp now use `Intl.DateTimeFormat` via a shared helper, and numeric values (comment counts, bio length counters, validation messages that interpolate numeric limits) use `Intl.NumberFormat`. These changes are centralized in the i18n module so they automatically track the active locale and apply consistently across all languages, including RTL locales and Simplified Chinese.

## Decisions & Rationale

### Centralize formatting in the i18n module

Rather than calling `toLocaleDateString` or `toLocaleString` ad hoc in each component, the formatting logic is encapsulated in `src/i18n/index.js`:

```js
export function formatNumber(value) {
  if (value == null) return ''
  const numeric = Number(value)
  if (Number.isNaN(numeric)) return String(value)
  return new Intl.NumberFormat(locale.value).format(numeric)
}

export function formatDateTime(value) {
  if (!value) return ''
  const date = value instanceof Date ? value : new Date(value)
  if (Number.isNaN(date.getTime())) return ''
  return new Intl.DateTimeFormat(locale.value, {
    dateStyle: 'medium',
    timeStyle: 'short',
  }).format(date)
}
```

This design keeps:

- **The store** free of formatting concerns (it only holds ISO timestamps and numeric constants).
- **Components** simple — they call `formatDateTime` / `formatNumber` without worrying about locale strings or formatting options.
- **Locale awareness** centralized, so changing formatting rules later (e.g., from `medium` to `long` date style) is a single edit.

### Use `Intl.DateTimeFormat` instead of `toLocaleDateString`

Previously, both `PostView` and `CommentList` used `new Date(iso).toLocaleDateString(locale)` directly. That had a few issues:

- It only showed the date (no time), even though the underlying data is a full timestamp.
- The options were implicit and not documented.
- It duplicated logic in multiple components.

Switching to `Intl.DateTimeFormat` with explicit `{ dateStyle: 'medium', timeStyle: 'short' }` yields:

- Clear, locale-appropriate formatting (e.g., `Feb 25, 2026, 5:00 AM` in English, `25‏/02‏/2026، 5:00 ص` in Arabic).
- An explicit time-of-day component, which aligns with the “timestamp” wording in the prompt.
- A single formatting rule that can be changed in one place if product requirements evolve.

### Use `Intl.NumberFormat` for user-visible numbers

The UI exposes several numeric values:

- The comment count in the post header: `Comments (3)` / localized equivalents.
- The bio character counter: `0 / 160`.
- Validation messages that interpolate the maximum bio length (`{max}`).

Without explicit number formatting, these values appear as raw Western digits (`0`, `160`, `3`) regardless of locale. Using `Intl.NumberFormat(locale.value)` ensures:

- Arabic locales get Arabic-Indic digits for counts and character limits.
- All locales use their standard digit grouping and symbols (important for larger numbers in future steps).

To avoid coupling validation logic in the store to the i18n layer, the store still emits pure numeric constraints (for example, `BIO_MAX_LENGTH`), and components decide how to format them for display.\n+

## Ambiguities Encountered

### How much detail should timestamps show?

**Options:**

1. Date only (status quo before this step).
2. Date + short time-of-day.
3. Full date-time including seconds and timezone.

**Resolution:** Use `dateStyle: 'medium', timeStyle: 'short'` (option 2). This gives users a clear sense of when a post/comment was created without overwhelming them with technical details like timezone abbreviations. It also keeps the markup simple (`<time>` element with ISO `datetime` attribute and localized text content).

### Should the number formatter be used *inside* `t()` or before calling it?

Error messages like `validation.bioTooLong` contain `{max}` placeholders. There are two ways to integrate number formatting:

- Pass raw numeric values to `t()` and have `t()` or the i18n layer apply `Intl.NumberFormat` internally.
- Format numbers first and pass formatted strings as params.

**Resolution:** Format numbers **before** calling `t()` in the component layer (e.g., `t(key, { max: formatNumber(BIO_MAX_LENGTH) })`). This keeps `t()` simple and side-effect-free: it performs string lookup and parameter substitution, but does not try to infer which parameters represent numbers vs strings. If more sophisticated formatting is required later (currency, percentages), components can choose appropriate helpers.

### Should timestamps be user-configurable (relative vs absolute)?\n+

The prompt specifies “Improve formatting” but does not require relative time (\"3 minutes ago\"), which would add non-trivial logic and translation keys.\n+

**Resolution:** Keep timestamps absolute but better formatted. Relative timestamps remain a potential future enhancement.\n+

## Tradeoffs\n+

- **Centralized helpers vs adhoc calls.** Centralizing `formatNumber` and `formatDateTime` simplifies maintenance at the cost of one extra import in components. This was judged worth it because formatting logic is now consistent and testable.\n+
- **Date+time vs date-only.** Showing time adds visual noise but matches the idea of a timestamp and provides more utility in a conversation context. The chosen `short` time style keeps it compact.\n+
- **Always using locale digit shapes.** In locales like Arabic, digits change to Arabic-Indic. This is desirable for native speakers but might surprise some bilingual developers reading logs or screenshots. On balance, respecting the locale is the right UX call.\n+

## Non-Goals\n+

- **Time zone selection or display.** All dates are rendered in the browser’s local timezone; there is no UI for changing that.\n+
- **Relative or fuzzy time formatting.** No “x minutes ago” strings were added.\n+
- **Currency or percentage formatting.** `formatNumber` only handles plain numeric values; specialized formats can be layered later.\n+
- **Reformatting existing seed timestamps.** The underlying ISO strings in `seed.json` remain unchanged.\n+

## Files Changed\n+

- `src/i18n/index.js`\n+
  - Added `formatNumber(value)` using `Intl.NumberFormat(locale.value)`.\n+
  - Added `formatDateTime(value)` using `Intl.DateTimeFormat(locale.value, { dateStyle: 'medium', timeStyle: 'short' })`.\n+
- `src/views/PostView.vue`\n+
  - Replaced inline `toLocaleDateString(locale)` with `formatDateTime(post.createdAt)` for the post timestamp.\n+
  - Updated the comments heading to use the number formatter: `t('post.commentsCount', { count: formatNumber(comments.length) })`.\n+
- `src/components/CommentList.vue`\n+
  - Replaced inline `toLocaleDateString(locale)` calls with `formatDateTime(comment.createdAt)` for each comment timestamp.\n+
- `src/components/CreateUserForm.vue`\n+
  - Updated validation error rendering to pass a formatted `max` value: `t(key, { max: formatNumber(BIO_MAX_LENGTH) })`.\n+
  - Updated the bio character counter to show localized digits: `{{ formatNumber(bioLength) }} / {{ formatNumber(BIO_MAX_LENGTH) }}`.\n+

## Manual Verification Checklist\n+

- [x] Build succeeds (`npm run build`).\n+
- [x] In English:\n+
  - [x] The post timestamp shows as an English medium date with short time (e.g., `Feb 25, 2026, 5:00 AM`).\n+
  - [x] Comment timestamps show localized dates (e.g., `2/25/2026`).\n+
  - [x] The comments header shows `Comments (3)` with the `3` produced by `Intl.NumberFormat('en')`.\n+
  - [x] The bio counter shows `0 / 160` and increments correctly as the user types.\n+
- [x] In Arabic:\n+
  - [x] The post timestamp appears in Arabic date/time format (e.g., `25‏/02‏/2026، 5:00 ص`).\n+
  - [x] Comment timestamps use the same Arabic-style date.\n+
  - [x] The comments heading shows Arabic digits in the count portion.\n+
  - [x] The bio counter uses Arabic-Indic digits for both current length and max.\n+
- [x] In Simplified Chinese:\n+
  - [x] Post and comment timestamps use Chinese date order (e.g., `2026/2/25` with localized time).\n+
  - [x] Comment count and bio counter digits render correctly.\n+
- [x] Switching languages re-renders timestamps and numeric values without reloading the page.\n+
- [x] Character limit validation messages interpolate the localized maximum value (e.g., `160` in Chinese/EU locales, Arabic-Indic digits in Arabic).\n+

## Known Issues / Follow-ups\n+

- **Mixed content language.** Timestamps and numbers localize, but the body text of posts and comments remains English, which can look odd in non-English UIs. Full content localization is a separate concern.\n+
- **Hard-coded date/time styles.** The `medium`/`short` combination is a reasonable default but might not match product requirements in all cases. Future steps could expose this as configuration or per-context options.\n+
- **No semantic timezone indicator.** Users in different timezones will see timestamps in their local time without an explicit indicator; for a collaborative multi-timezone app, explicit timezones or relative times may be required.\n+

