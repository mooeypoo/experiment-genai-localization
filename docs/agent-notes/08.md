# Step 08 — Hebrew, Arabic & Farsi (RTL Language Support)

## Summary

Added Hebrew (he), Arabic (ar), and Farsi/Persian (fa) as supported locales. These three languages use right-to-left (RTL) writing direction, which required both new locale data and layout changes so the entire UI flips appropriately when an RTL language is selected.

## Decisions & Rationale

### RTL via `document.documentElement.dir`

The standard way to flip an HTML document is setting `dir="rtl"` on the `<html>` element. The i18n module now uses a `watchEffect` that syncs both `lang` and `dir` onto `document.documentElement` whenever the reactive `locale` ref changes. This is a single point of control and avoids per-component direction logic.

An alternative was using a CSS class (e.g., `.rtl`) on the root element and writing manual CSS rules. The `dir` attribute was chosen because it is the semantic, standards-based mechanism — browsers, screen readers, and native form controls all respect it natively. Flexbox `row` direction, text alignment, and `<select>` dropdown positioning all flip automatically when `dir="rtl"` is set.

### CSS Logical Properties over physical directions

All physical directional properties in existing CSS were replaced with logical equivalents:

| Before | After |
|---|---|
| `margin-left: auto` | `margin-inline-start: auto` |
| `text-align: right` | `text-align: end` |

CSS logical properties are direction-aware: `inline-start` maps to "left" in LTR and "right" in RTL. This means a single CSS rule works correctly in both directions without `[dir="rtl"]` overrides. Browser support for logical properties is excellent (baseline since 2020).

Properties like `text-align: center`, `margin: 0 auto`, and `flex-direction: column` are already direction-neutral and required no changes.

### RTL locale set in the i18n module

A `RTL_LOCALES` set and a computed `dir` export were added to `src/i18n/index.js`. The set currently contains `he`, `ar`, and `fa`. Keeping this metadata in the i18n module (rather than in each locale file) keeps locale files as pure translation data and centralizes layout concerns. If a locale file needed to declare its own directionality, it would couple translation data with presentation.

### Language names rendered in their native script

Each language continues to be displayed in its own script in the language switcher dropdown (e.g., "עברית", "العربية", "فارسی"). All six locale files now include all six language name entries in their `lang` section, ensuring the dropdown labels remain consistent regardless of which language is currently active.

## Ambiguities Encountered

### Should form inputs use `dir="auto"` for mixed-direction content?

**Options:**
1. Set `dir="auto"` on text inputs so the browser infers direction from the first strong character typed.
2. Let inputs inherit the document direction.

**Resolution:** Inherited direction (option 2). In a social app, users typing in RTL languages with an RTL UI will expect RTL input alignment. The `dir="auto"` attribute is useful when a single page might receive both LTR and RTL user input simultaneously (e.g., a multilingual chat). Our app's language setting already controls the expected input direction. This can be revisited if mixed-direction input becomes a need.

### Should the `<html lang>` attribute reflect the full BCP 47 tag (e.g., `he-IL`, `ar-SA`, `fa-IR`)?

**Options:**
1. Use region-qualified tags.
2. Use bare language codes.

**Resolution:** Bare language codes (`he`, `ar`, `fa`). The app has no region-specific content, date formatting already delegates to the browser's `toLocaleDateString(locale)` which handles regional variants, and adding regions would complicate the locale system without benefit at this scale.

### How much font support is needed for RTL scripts?

**Options:**
1. Add explicit RTL-supporting web fonts.
2. Rely on the existing system font stack.

**Resolution:** Rely on system fonts. Modern operating systems ship with high-quality fonts for Hebrew, Arabic, and Farsi. The existing `font-family: Inter, system-ui, -apple-system, sans-serif` stack falls through to system-ui for scripts that Inter doesn't cover. Adding Noto Sans Arabic/Hebrew would improve consistency across platforms but increases bundle size for a demo app.

## Tradeoffs

| Tradeoff | Chosen | Alternative | Reason |
|---|---|---|---|
| Direction mechanism | `dir` attribute on `<html>` | CSS class with manual overrides | Standards-based, automatic browser behavior |
| CSS approach | Logical properties | `[dir="rtl"]` selector overrides | One rule for both directions, no duplication |
| Font stack | System fonts | Explicit RTL web fonts | Simplicity; system fonts cover these scripts well |
| Input direction | Inherited from document | `dir="auto"` per input | Consistent with UI language; revisitable |

## Non-Goals

- **Locale persistence.** Language selection resets on page refresh (consistent with prior steps).
- **RTL-specific typographic fine-tuning.** No kashida justification, no bidirectional text isolation markers — these are relevant for production Arabic/Farsi apps but beyond demo scope.
- **Region-specific formatting.** No locale-region variants (e.g., `ar-EG` vs `ar-SA`).
- **Professional translation review.** Translations are best-effort; a native speaker review would be appropriate for a production app.

## Files Changed

| File | Change |
|---|---|
| `src/i18n/locales/he.js` | New — Hebrew translations |
| `src/i18n/locales/ar.js` | New — Arabic translations |
| `src/i18n/locales/fa.js` | New — Farsi translations |
| `src/i18n/index.js` | Added `he`, `ar`, `fa` imports; `RTL_LOCALES` set; `dir` computed; `watchEffect` to sync `document.documentElement.dir` and `.lang` |
| `src/i18n/locales/en.js` | Added `he`, `ar`, `fa` entries to `lang` section |
| `src/i18n/locales/fr.js` | Added `he`, `ar`, `fa` entries to `lang` section |
| `src/i18n/locales/es.js` | Added `he`, `ar`, `fa` entries to `lang` section |
| `src/components/AppHeader.vue` | `margin-left: auto` → `margin-inline-start: auto` |
| `src/components/CommentList.vue` | `margin-left: auto` → `margin-inline-start: auto` |
| `src/components/CreateUserForm.vue` | `text-align: right` → `text-align: end` |

## Manual Verification Checklist

- [ ] Switch to Hebrew — entire UI flips RTL; brand on right, controls on left.
- [ ] Switch to Arabic — same RTL flip; all labels translated.
- [ ] Switch to Farsi — same RTL flip; all labels translated.
- [ ] Switch back to English — UI restores to LTR cleanly.
- [ ] Switch back to French/Spanish — UI remains LTR.
- [ ] Post page in RTL: comment timestamps float to the start (left in RTL), avatars on the right.
- [ ] Users page in RTL: card grid flows right-to-left; form fields right-aligned.
- [ ] User profile page in RTL: centered layout remains centered.
- [ ] Character counter in RTL: positioned at the "end" (left side in RTL).
- [ ] Language dropdown shows all 6 languages in their native scripts.
- [ ] Validation errors display correctly in all 3 RTL languages.
- [ ] Date formatting uses locale-appropriate format (e.g., Hebrew uses `25.2.2026`).

## Known Issues / Follow-ups

- **Seeded content is English.** Post body and comments remain in English regardless of UI language. A production app would either translate content or mark it with `dir="auto"` for mixed-direction display.
- **No bidirectional text isolation.** If a Hebrew user creates a comment mixing Hebrew and English, the text may not render with ideal bidi boundaries. The `<bdi>` element or Unicode isolation markers could address this in a future step.
- **System font fallback.** On minimal Linux installations without Arabic/Hebrew fonts installed, characters may render with a fallback or tofu. This is an OS-level concern, not an app-level one.
- **No `dir="auto"` on user-generated content.** Comments and bios inherit the document direction. If LTR content is entered while in RTL mode, it will right-align. This is acceptable for a demo but should be revisited for production.
